import sys, argparse
from PyQt4 import QtGui, QtCore
from skymap import Skymap
from srt import SRT

class Mode:
    LIVE = 0
    SIM = 1

class mainWindow(QtGui.QMainWindow):
    def __init__(self, srt, parent=None):
        super(mainWindow,self).__init__(parent=parent)
        self.setGeometry(50,50,600,800)
        self.setWindowTitle("SRT Drive Control")
        self.srt = srt
        self.skymap = Skymap(self)
        self.skymap.setCurrentPos(self.srt.getCurrentPos())
        self.skymap.init()
        self.updateStatusBar("This is the status bar.")
        self.formWidget = formWidget(self)
        #self.setCentralWidget(self.formWidget)
        #self.mode = Mode.SIM # default
        
    def updateStatusBar(self,status):
        self.statusBar().showMessage(str(status))
        
    def getSRT(self):
        return self.srt

    def setMode(self,mode):
        self.mode = mode

    def getMode(self):
        return self.mode

class formWidget(QtGui.QWidget):
    def __init__(self,parent):
        super(formWidget,self).__init__(parent)
        self.setGeometry(0,0,150,150)
        self.layout = QtGui.QVBoxLayout(self)
        
        self.stowButton = QtGui.QPushButton("Stow")
        #self.button1.setMinimumSize(100,200)
        self.layout.addWidget(self.stowButton)
        self.stowButton.clicked.connect(self.handleStowButton)

        self.slewButton = QtGui.QPushButton("Slew")
        self.layout.addWidget(self.slewButton)
        self.slewButton.clicked.connect(self.handleSlewButton)

        self.trackButton = QtGui.QPushButton("Track")
        self.layout.addWidget(self.trackButton)
        self.trackButton.clicked.connect(self.handleTrackButton)
        
        self.label = QtGui.QLabel("azel: " + str(parent.srt.getCurrentPos()))
        self.layout.addWidget(self.label)
        
        self.setLayout(self.layout)

    def handleStowButton(self):
        pass

    def handleSlewButton(self):
        pass

    def handleTrackButton(self):
        pass


def run():
    app = QtGui.QApplication(sys.argv)
    #srt = SRT()
    #main = mainWindow(srt)

    parser = argparse.ArgumentParser()
    parser.add_argument('-live',dest='live',action='store_true',
                        help='Starts main in live mode.')
    parser.add_argument('-sim',dest='sim',action='store_true',
                        help='Starts main in simulation mode.')
    args = parser.parse_args()
    #print args.live,args.sim
    if args.live == True and args.sim == False:
        print "Live mode enabled."
        #main.setMode(Mode.LIVE)
        mode = Mode.LIVE
    elif args.live == False and args.sim == True:
        print "Simulation mode enabled."
        #main.setMode(Mode.SIM)
        mode = Mode.SIM

    srt = srt(mode)
    main = mainWindow(srt)
    
    
    #skymap_size = (100,0,100,100)
    #pos = (80,100)
    #srt = SRT()
    #skymap = Skymap(main)
    #skymap.setCurrentPos(pos)
    #skymap.init()
    main.show()
    sys.exit(app.exec_())

run()

   
 
   
